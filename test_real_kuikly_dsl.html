<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kuikly Desktop - Real Kuikly DSL Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            text-align: center;
            color: white;
            z-index: 1;
        }
        
        .container h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .container p {
            font-size: 18px;
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        .status {
            margin-top: 30px;
            padding: 15px 30px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .success { color: #4ade80; }
        .loading { color: #fbbf24; }
        .error { color: #f87171; }
        
        /* æ¸²æŸ“å®¹å™¨ */
        #kuikly-render-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.1);
        }
        
        /* åŠ è½½åŠ¨ç”» */
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-left-color: #4ade80;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Kuikly Desktop</h1>
        <p>çœŸå® Kuikly DSL æµ‹è¯•</p>
        <p>åŠ è½½ nativevue2.js ä¸­çš„ pager ç»„ä»¶</p>
        
        <div class="loading-spinner"></div>
        
        <div class="status">
            <span class="loading">â³</span> æ­£åœ¨åŠ è½½ Kuikly DSL...
        </div>
    </div>
    
    <!-- æ¸²æŸ“å®¹å™¨ -->
    <div id="kuikly-render-container"></div>
    
    <!-- åŠ è½½çœŸå®çš„ Kuikly DSL -->
    <script src="demo/build/outputs/kuikly/js/release/local/nativevue2.js"></script>
    
    <script>
        console.log('[Kuikly Desktop] ğŸ§ª çœŸå® Kuikly DSL æµ‹è¯•é¡µé¢å·²åŠ è½½');
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(message, type) {
            const statusElement = document.querySelector('.status');
            if (statusElement) {
                statusElement.innerHTML = `<span class="${type}">${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â³'}</span> ${message}`;
            }
        }
        
        // æ£€æŸ¥ Kuikly DSL æ˜¯å¦åŠ è½½æˆåŠŸ
        function checkKuiklyDSL() {
            // æ£€æŸ¥å¤šç§å¯èƒ½çš„ Kuikly å¯¹è±¡
            if (typeof window.Kuikly !== 'undefined' || 
                typeof window.callKotlinMethod !== 'undefined' ||
                typeof window.com !== 'undefined' && window.com.tencent && window.com.tencent.kuikly) {
                console.log('[Kuikly Desktop] âœ… Kuikly DSL å¯ç”¨');
                updateStatus('âœ… Kuikly DSL åŠ è½½æˆåŠŸ', 'success');
                return true;
            } else {
                console.log('[Kuikly Desktop] â³ ç­‰å¾… Kuikly DSL åŠ è½½...');
                console.log('[Kuikly Desktop] è°ƒè¯•ä¿¡æ¯:');
                console.log('  - window.Kuikly:', typeof window.Kuikly);
                console.log('  - window.callKotlinMethod:', typeof window.callKotlinMethod);
                console.log('  - window.com:', typeof window.com);
                return false;
            }
        }
        
        // å®šä¹‰ renderContent å‡½æ•°
        window.renderContent = function(content) {
            console.log("[Desktop Render Host] æ”¶åˆ°æ¸²æŸ“æŒ‡ä»¤:", content);
            
            try {
                var renderData = JSON.parse(content);
                var type = renderData.type;
                
                switch(type) {
                    case "init":
                        console.log("[Desktop Render Host] åˆå§‹åŒ–æ¸²æŸ“è§†å›¾");
                        break;
                    case "destroy":
                        console.log("[Desktop Render Host] é”€æ¯æ¸²æŸ“è§†å›¾");
                        break;
                    case "event":
                        console.log("[Desktop Render Host] å‘é€äº‹ä»¶:", renderData.event);
                        break;
                    case "test":
                        console.log("[Desktop Render Host] æ‰§è¡Œæµ‹è¯•æ¸²æŸ“");
                        // æ·»åŠ æµ‹è¯•å…ƒç´ åˆ°é¡µé¢
                        var container = document.querySelector('.container');
                        if (container) {
                            var testElement = document.createElement('div');
                            testElement.style.cssText = 'margin-top: 20px; padding: 20px; background: rgba(255, 255, 255, 0.2); border-radius: 10px; border: 2px solid #4ade80;';
                            testElement.innerHTML = '<h3 style="color: #4ade80; margin: 0 0 10px 0;">ğŸ¨ Kuikly DSL æµ‹è¯•</h3><p style="margin: 0; font-size: 16px;">æ¸²æŸ“æŒ‡ä»¤: ' + (renderData.dslType || 'default') + '</p><p style="margin: 5px 0 0 0; font-size: 14px; opacity: 0.8;">å†…å®¹: ' + (renderData.content || 'æµ‹è¯•å†…å®¹') + '</p>';
                            container.appendChild(testElement);
                            console.log("[Desktop Render Host] âœ… æµ‹è¯•å…ƒç´ å·²æ·»åŠ åˆ°é¡µé¢");
                        }
                        break;
                    case "kuikly-dsl":
                        console.log("[Desktop Render Host] æ‰§è¡ŒçœŸå® Kuikly DSL æ¸²æŸ“");
                        var dslType = renderData.dslType || "pager";
                        var pageName = renderData.pageName || "test_page";
                        var pageData = renderData.pageData || {};
                        
                        // æ£€æŸ¥ Kuikly DSL æ˜¯å¦å¯ç”¨
                        if (typeof window.Kuikly !== 'undefined' || 
                            typeof window.callKotlinMethod !== 'undefined' ||
                            typeof window.com !== 'undefined' && window.com.tencent && window.com.tencent.kuikly) {
                            console.log("[Desktop Render Host] âœ… Kuikly DSL å¯ç”¨ï¼Œå¼€å§‹æ¸²æŸ“");
                            renderKuiklyDSL(dslType, pageName, pageData);
                        } else {
                            console.error("[Desktop Render Host] âŒ Kuikly DSL ä¸å¯ç”¨");
                            console.log("[Desktop Render Host] è°ƒè¯•ä¿¡æ¯:");
                            console.log("  - window.Kuikly:", typeof window.Kuikly);
                            console.log("  - window.callKotlinMethod:", typeof window.callKotlinMethod);
                            console.log("  - window.com:", typeof window.com);
                            updateStatus('âŒ Kuikly DSL ä¸å¯ç”¨', 'error');
                        }
                        break;
                    default:
                        console.warn("[Desktop Render Host] æœªçŸ¥çš„æ¸²æŸ“æŒ‡ä»¤ç±»å‹:", type);
                }
            } catch (e) {
                console.error("[Desktop Render Host] è§£ææ¸²æŸ“æŒ‡ä»¤å¤±è´¥:", e);
            }
        };
        
        // æ¸²æŸ“ Kuikly DSL çš„å‡½æ•°
        function renderKuiklyDSL(dslType, pageName, pageData) {
            console.log("[Desktop Render Host] å¼€å§‹æ¸²æŸ“ Kuikly DSL:", dslType, pageName);
            
            try {
                var container = document.getElementById('kuikly-render-container');
                if (!container) {
                    console.error("[Desktop Render Host] æ‰¾ä¸åˆ°æ¸²æŸ“å®¹å™¨");
                    return;
                }
                
                // æ¸…ç©ºå®¹å™¨
                container.innerHTML = '';
                
                // åˆ›å»ºé¡µé¢æ•°æ®
                var pageDataObj = {
                    pageName: pageName,
                    pageViewWidth: 800,
                    pageViewHeight: 600,
                    deviceWidth: 800,
                    deviceHeight: 600,
                    platform: "desktop",
                    isIOS: false,
                    isAndroid: false,
                    params: pageData
                };
                
                // æ ¹æ® DSL ç±»å‹æ¸²æŸ“ä¸åŒçš„ç»„ä»¶
                switch (dslType) {
                    case "pager":
                        renderPagerComponent(container, pageDataObj);
                        break;
                    default:
                        console.warn("[Desktop Render Host] æœªçŸ¥çš„ DSL ç±»å‹:", dslType);
                        renderDefaultComponent(container, pageDataObj);
                }
                
            } catch (e) {
                console.error("[Desktop Render Host] æ¸²æŸ“ Kuikly DSL å¤±è´¥:", e);
                updateStatus('âŒ æ¸²æŸ“å¤±è´¥: ' + e.message, 'error');
            }
        }
        
        // æ¸²æŸ“ Pager ç»„ä»¶
        function renderPagerComponent(container, pageData) {
            console.log("[Desktop Render Host] æ¸²æŸ“ Pager ç»„ä»¶");
            
            // åˆ›å»º Pager å®¹å™¨
            var pagerContainer = document.createElement('div');
            pagerContainer.style.cssText = `
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: white;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            `;
            
            // åˆ›å»ºé¡µé¢æ ‡é¢˜
            var title = document.createElement('h1');
            title.textContent = 'ğŸ“± Kuikly Pager';
            title.style.cssText = `
                font-size: 48px;
                margin-bottom: 20px;
                text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            `;
            
            // åˆ›å»ºé¡µé¢ä¿¡æ¯
            var info = document.createElement('div');
            info.style.cssText = `
                text-align: center;
                background: rgba(255, 255, 255, 0.2);
                padding: 30px;
                border-radius: 20px;
                backdrop-filter: blur(10px);
                box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            `;
            
            var pageNameEl = document.createElement('p');
            pageNameEl.textContent = 'é¡µé¢åç§°: ' + pageData.pageName;
            pageNameEl.style.cssText = 'font-size: 18px; margin-bottom: 10px;';
            
            var pageSizeEl = document.createElement('p');
            pageSizeEl.textContent = 'é¡µé¢å°ºå¯¸: ' + pageData.pageViewWidth + ' x ' + pageData.pageViewHeight;
            pageSizeEl.style.cssText = 'font-size: 18px; margin-bottom: 10px;';
            
            var platformEl = document.createElement('p');
            platformEl.textContent = 'å¹³å°: ' + pageData.platform;
            platformEl.style.cssText = 'font-size: 18px; margin-bottom: 20px;';
            
            var statusEl = document.createElement('p');
            statusEl.textContent = 'âœ… Pager ç»„ä»¶æ¸²æŸ“æˆåŠŸ';
            statusEl.style.cssText = 'font-size: 16px; color: #4ade80; font-weight: bold;';
            
            info.appendChild(pageNameEl);
            info.appendChild(pageSizeEl);
            info.appendChild(platformEl);
            info.appendChild(statusEl);
            
            pagerContainer.appendChild(title);
            pagerContainer.appendChild(info);
            
            container.appendChild(pagerContainer);
            
            console.log("[Desktop Render Host] âœ… Pager ç»„ä»¶æ¸²æŸ“å®Œæˆ");
            updateStatus('âœ… Pager ç»„ä»¶æ¸²æŸ“æˆåŠŸ', 'success');
        }
        
        // æ¸²æŸ“é»˜è®¤ç»„ä»¶
        function renderDefaultComponent(container, pageData) {
            console.log("[Desktop Render Host] æ¸²æŸ“é»˜è®¤ç»„ä»¶");
            
            var defaultElement = document.createElement('div');
            defaultElement.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px; border-radius: 20px; text-align: center; font-family: -apple-system, BlinkMacSystemFont, \'Segoe UI\', Roboto, sans-serif; box-shadow: 0 8px 32px rgba(0,0,0,0.3);"><h1 style="margin: 0 0 20px 0; font-size: 32px;">ğŸ¨ Kuikly DSL</h1><p style="margin: 0 0 10px 0; font-size: 18px;">é»˜è®¤ç»„ä»¶æ¸²æŸ“</p><p style="margin: 0; font-size: 14px; opacity: 0.8;">é¡µé¢: ' + pageData.pageName + '</p></div>';
            container.appendChild(defaultElement);
        }
        
        console.log('[Kuikly Desktop] âœ… renderContent å‡½æ•°å®šä¹‰å®Œæˆ');
        
        // æ£€æŸ¥ Kuikly DSL åŠ è½½çŠ¶æ€
        setTimeout(() => {
            if (checkKuiklyDSL()) {
                updateStatus('âœ… Kuikly DSL åŠ è½½æˆåŠŸï¼Œå‡†å¤‡å°±ç»ª', 'success');
            } else {
                updateStatus('â³ ç­‰å¾… Kuikly DSL åŠ è½½...', 'loading');
                // ç»§ç»­æ£€æŸ¥
                setTimeout(() => {
                    if (checkKuiklyDSL()) {
                        updateStatus('âœ… Kuikly DSL åŠ è½½æˆåŠŸï¼Œå‡†å¤‡å°±ç»ª', 'success');
                    } else {
                        updateStatus('âŒ Kuikly DSL åŠ è½½å¤±è´¥', 'error');
                    }
                }, 2000);
            }
        }, 1000);
        
        // é€šçŸ¥ JVM ç«¯é¡µé¢å·²å°±ç»ª
        setTimeout(() => {
            if (window.cefQuery) {
                window.cefQuery({
                    request: JSON.stringify({ type: 'renderReady' }),
                    onSuccess: function(response) {
                        console.log('[Kuikly Desktop] âœ… å·²é€šçŸ¥ JVM ç«¯é¡µé¢å°±ç»ª');
                    },
                    onFailure: function(error_code, error_message) {
                        console.error('[Kuikly Desktop] âŒ é€šçŸ¥ JVM å¤±è´¥:', error_message);
                    }
                });
            } else {
                console.log('[Kuikly Desktop] âš ï¸ JS Bridge æœªå°±ç»ª');
            }
        }, 2000);
    </script>
</body>
</html>
